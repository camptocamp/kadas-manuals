<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QGIS API Documentation: /home/sandro/Documents/Devel/QGIS/qgis-enterprise-kadas/src/gui/qgsprojectionselector.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QGIS API Documentation
   &#160;<span id="projectnumber">2.15.2-KADAS</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_99d0482cf009f9d97a0877749b817f19.html">gui</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">qgsprojectionselector.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="qgsprojectionselector_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/***************************************************************************</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *   qgsprojectionselector.cpp                                             *</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *   Copyright (C) 2005 by Tim Sutton                                      *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *   tim@linfiniti.com                                                     *</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *                                                                         *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *   This program is free software; you can redistribute it and/or modify  *</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *   it under the terms of the GNU General Public License as published by  *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *   the Free Software Foundation; either version 2 of the License, or     *</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *   (at your option) any later version.                                   *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> ***************************************************************************/</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="qgsprojectionselector_8h.html">qgsprojectionselector.h</a>&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">//standard includes</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;sqlite3.h&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">//qgis includes</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="qgis_8h.html">qgis.h</a>&quot;</span> <span class="comment">//magic numbers here</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="qgsapplication_8h.html">qgsapplication.h</a>&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="qgslogger_8h.html">qgslogger.h</a>&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="qgscoordinatereferencesystem_8h.html">qgscoordinatereferencesystem.h</a>&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">//qt includes</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &lt;QFileInfo&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &lt;QHeaderView&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;QResizeEvent&gt;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;QMessageBox&gt;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;QSettings&gt;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a40d5cbda59e1a36fd5ae761c42b24576">   29</a></span>&#160;<a class="code" href="classQgsProjectionSelector.html#a40d5cbda59e1a36fd5ae761c42b24576">QgsProjectionSelector::QgsProjectionSelector</a>( QWidget* parent, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, Qt::WindowFlags fl )</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    : QWidget( parent, fl )</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    , mUserProjList( NULL )</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    , mGeoList( NULL )</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    , mProjList( NULL )</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    , mProjListDone( false )</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    , mUserProjListDone( false )</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    , mRecentProjListDone( false )</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    , mSearchColumn( NONE )</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    , mPushProjectionToFront( false )</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;{</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  Q_UNUSED( name );</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  setupUi( <span class="keyword">this</span> );</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="keywordflow">if</span> ( qobject_cast&lt;QDialog*&gt;( parent ) )</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  {</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// mark selected projection for push to front if parent dialog is accepted</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    connect( parent, SIGNAL( accepted() ), <span class="keyword">this</span>, SLOT( <a class="code" href="classQgsProjectionSelector.html#a371a1135cb3f5ca64ffece48a48c1f31">pushProjectionToFront</a>() ) );</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  }</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">// Get the full path name to the sqlite3 spatial reference database.</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  mSrsDatabaseFileName = <a class="code" href="classQgsApplication.html#ade49108acdad95ab09c8098a528659f8">QgsApplication::srsDbFilePath</a>();</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  lstCoordinateSystems-&gt;header()-&gt;setResizeMode( AUTHID_COLUMN, QHeaderView::Stretch );</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  lstCoordinateSystems-&gt;header()-&gt;resizeSection( QGIS_CRS_ID_COLUMN, 0 );</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  lstCoordinateSystems-&gt;header()-&gt;setResizeMode( QGIS_CRS_ID_COLUMN, QHeaderView::Fixed );</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// Hide (internal) ID column</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  lstCoordinateSystems-&gt;setColumnHidden( QGIS_CRS_ID_COLUMN, <span class="keyword">true</span> );</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  lstRecent-&gt;header()-&gt;setResizeMode( AUTHID_COLUMN, QHeaderView::Stretch );</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  lstRecent-&gt;header()-&gt;resizeSection( QGIS_CRS_ID_COLUMN, 0 );</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  lstRecent-&gt;header()-&gt;setResizeMode( QGIS_CRS_ID_COLUMN, QHeaderView::Fixed );</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">// Hide (internal) ID column</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  lstRecent-&gt;setColumnHidden( QGIS_CRS_ID_COLUMN, <span class="keyword">true</span> );</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  mRecentProjections = <a class="code" href="classQgsCoordinateReferenceSystem.html#a22bb0b4fee4e7e251f52433df846e202">QgsCoordinateReferenceSystem::recentProjections</a>();</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#ae7cb639b4728c35a44c190ac89c6f7f2">   69</a></span>&#160;<a class="code" href="classQgsProjectionSelector.html#ae7cb639b4728c35a44c190ac89c6f7f2">QgsProjectionSelector::~QgsProjectionSelector</a>()</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;{</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">if</span> ( !mPushProjectionToFront )</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  }</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  <span class="comment">// Push current projection to front, only if set</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  <span class="keywordtype">long</span> crsId = <a class="code" href="classQgsProjectionSelector.html#a1032346d0b096da456d4cb2ba084e8a9">selectedCrsId</a>();</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="keywordflow">if</span> ( crsId == 0 )</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="comment">// Save persistent list of projects</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  mRecentProjections.removeAll( QString::number( crsId ) );</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  mRecentProjections.prepend( QString::number( crsId ) );</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// Prune size of list</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">while</span> ( mRecentProjections.size() &gt; 8 )</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  {</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    mRecentProjections.removeLast();</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  <span class="comment">// Save to file *** Should be removed sometims in the future ***</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  QSettings settings;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  settings.setValue( <span class="stringliteral">&quot;/UI/recentProjections&quot;</span>, mRecentProjections );</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="comment">// Convert to EPSG and proj4, and save those values also</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  QStringList projectionsProj4;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  QStringList projectionsAuthId;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt;  mRecentProjections.size(); i++ )</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="comment">// Create a crs from the crsId</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="classQgsCoordinateReferenceSystem.html">QgsCoordinateReferenceSystem</a> crs( mRecentProjections.at( i ).toLong(), <a class="code" href="classQgsCoordinateReferenceSystem.html#a50be71ef85725c7a3959f780ac7c36cfabc92b4ee3c6be188b5dfe000ddac415e">QgsCoordinateReferenceSystem::InternalCrsId</a> );</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">if</span> ( ! crs.isValid() )</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      <span class="comment">// No? Skip this entry</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    }</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    projectionsProj4 &lt;&lt; crs.<a class="code" href="classQgsCoordinateReferenceSystem.html#a433853323df4837869a2a8c2ad7521ea">toProj4</a>();</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    projectionsAuthId &lt;&lt; crs.authid();</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  }</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  settings.setValue( <span class="stringliteral">&quot;/UI/recentProjectionsProj4&quot;</span>, projectionsProj4 );</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  settings.setValue( <span class="stringliteral">&quot;/UI/recentProjectionsAuthId&quot;</span>, projectionsAuthId );</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;}</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a6f161369439d52b649c8f4f0a1d04e5d">  114</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#a6f161369439d52b649c8f4f0a1d04e5d">QgsProjectionSelector::resizeEvent</a>( QResizeEvent * theEvent )</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;{</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  lstCoordinateSystems-&gt;header()-&gt;resizeSection( NAME_COLUMN, theEvent-&gt;size().width() - 240 );</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  lstCoordinateSystems-&gt;header()-&gt;resizeSection( AUTHID_COLUMN, 240 );</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  lstCoordinateSystems-&gt;header()-&gt;resizeSection( QGIS_CRS_ID_COLUMN, 0 );</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  lstRecent-&gt;header()-&gt;resizeSection( NAME_COLUMN, theEvent-&gt;size().width() - 240 );</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  lstRecent-&gt;header()-&gt;resizeSection( AUTHID_COLUMN, 240 );</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  lstRecent-&gt;header()-&gt;resizeSection( QGIS_CRS_ID_COLUMN, 0 );</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a9c9e1adc0e4f1e4c909fe77675c565c1">  125</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#a9c9e1adc0e4f1e4c909fe77675c565c1">QgsProjectionSelector::showEvent</a>( QShowEvent * theEvent )</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;{</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  <span class="comment">// ensure the projection list view is actually populated</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// before we show this widget</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  <a class="code" href="classQgsProjectionSelector.html#a1bb002fb20806dd66fb66bd0179a0e9a">loadCrsList</a>( &amp;mCrsFilter );</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <a class="code" href="classQgsProjectionSelector.html#a26f2da62808f40c7bce476ab1eac9c4b">loadUserCrsList</a>( &amp;mCrsFilter );</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  <span class="keywordflow">if</span> ( !mRecentProjListDone )</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = mRecentProjections.size() - 1; i &gt;= 0; i-- )</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      insertRecent( mRecentProjections.at( i ).toLong() );</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    mRecentProjListDone = <span class="keyword">true</span>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;  <span class="comment">// apply deferred selection</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  applySelection();</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;  emit <a class="code" href="classQgsProjectionSelector.html#a1ee56be1f78b0ea3b43a489c85592ab6">initialized</a>();</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <span class="comment">// Pass up the inheritance hierarchy</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  QWidget::showEvent( theEvent );</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;QString QgsProjectionSelector::ogcWmsCrsFilterAsSqlExpression( QSet&lt;QString&gt; * crsFilter )</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;{</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  QString sqlExpression = <span class="stringliteral">&quot;1&quot;</span>;             <span class="comment">// it&#39;s &quot;SQL&quot; for &quot;true&quot;</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  QMap&lt;QString, QStringList&gt; authParts;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">if</span> ( !crsFilter )</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">return</span> sqlExpression;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;  <span class="comment">/*</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">     Ref: WMS 1.3.0, section 6.7.3 &quot;Layer CRS&quot;:</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">     Every Layer CRS has an identifier that is a character string. Two types of</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">     Layer CRS identifiers are permitted: &quot;label&quot; and &quot;URL&quot; identifiers:</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">     Label: The identifier includes a namespace prefix, a colon, a numeric or</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">        string code, and in some instances a comma followed by additional</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">        parameters. This International Standard defines three namespaces:</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">        CRS, EpsgCrsId and AUTO2 [...]</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">     URL: The identifier is a fully-qualified Uniform Resource Locator that</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">        references a publicly-accessible file containing a definition of the CRS</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">        that is compliant with ISO 19111.</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">  */</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  <span class="comment">// iterate through all incoming CRSs</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordflow">foreach</span> ( QString auth_id, crsFilter-&gt;values() )</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    QStringList parts = auth_id.split( <span class="stringliteral">&quot;:&quot;</span> );</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">if</span> ( parts.size() &lt; 2 )</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    authParts[ parts.at( 0 ).toUpper()].append( parts.at( 1 ).toUpper() );</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  }</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keywordflow">if</span> ( authParts.isEmpty() )</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keywordflow">return</span> sqlExpression;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="keywordflow">if</span> ( authParts.size() &gt; 0 )</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    QString prefix = <span class="stringliteral">&quot; AND (&quot;</span>;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keywordflow">foreach</span> ( QString auth_name, authParts.keys() )</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      sqlExpression += QString( <span class="stringliteral">&quot;%1(upper(auth_name)=&#39;%2&#39; AND upper(auth_id) IN (&#39;%3&#39;))&quot;</span> )</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                       .arg( prefix )</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                       .arg( auth_name )</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                       .arg( authParts[auth_name].join( <span class="stringliteral">&quot;&#39;,&#39;&quot;</span> ) );</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      prefix = <span class="stringliteral">&quot; OR &quot;</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    sqlExpression += <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;exiting with &#39;&quot;</span> + sqlExpression + <span class="stringliteral">&quot;&#39;.&quot;</span> );</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">return</span> sqlExpression;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;}</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a8b94413941d2887c38ddb7f9498e77c9">  206</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#a8b94413941d2887c38ddb7f9498e77c9">QgsProjectionSelector::setSelectedCrsName</a>( QString theCRSName )</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;{</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;  applySelection( NAME_COLUMN, theCRSName );</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#aeb54a075f8275a8e6c652d899f65db51">  211</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#aeb54a075f8275a8e6c652d899f65db51">QgsProjectionSelector::setSelectedCrsId</a>( <span class="keywordtype">long</span> theCRSID )</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;{</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  applySelection( QGIS_CRS_ID_COLUMN, QString::number( theCRSID ) );</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#ae9743d9161df77ed762178c4ec7b38d4">  216</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#ae9743d9161df77ed762178c4ec7b38d4">QgsProjectionSelector::setSelectedAuthId</a>( QString <span class="keywordtype">id</span> )</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;{</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  applySelection( AUTHID_COLUMN, <span class="keywordtype">id</span> );</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;}</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keywordtype">void</span> QgsProjectionSelector::applySelection( <span class="keywordtype">int</span> column, QString value )</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;{</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="keywordflow">if</span> ( !mProjListDone || !mUserProjListDone )</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <span class="comment">// defer selection until loaded</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    mSearchColumn = column;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    mSearchValue  = value;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  <span class="keywordflow">if</span> ( column == NONE )</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">// invoked deferred selection</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    column = mSearchColumn;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    value  = mSearchValue;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    mSearchColumn = NONE;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    mSearchValue.clear();</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  <span class="keywordflow">if</span> ( column == NONE )</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  QList&lt;QTreeWidgetItem*&gt; nodes = lstCoordinateSystems-&gt;findItems( value, Qt::MatchExactly | Qt::MatchRecursive, column );</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  <span class="keywordflow">if</span> ( nodes.count() &gt; 0 )</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( QString( <span class="stringliteral">&quot;found %1,%2&quot;</span> ).arg( column ).arg( value ) );</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    lstCoordinateSystems-&gt;setCurrentItem( nodes.first() );</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;  }</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;  {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( QString( <span class="stringliteral">&quot;nothing found for %1,%2&quot;</span> ).arg( column ).arg( value ) );</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="comment">// unselect the selected item to avoid confusing the user</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    lstCoordinateSystems-&gt;clearSelection();</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    lstRecent-&gt;clearSelection();</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    teProjection-&gt;setText( <span class="stringliteral">&quot;&quot;</span> );</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    teSelected-&gt;setText( <span class="stringliteral">&quot;&quot;</span> );</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;}</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="keywordtype">void</span> QgsProjectionSelector::insertRecent( <span class="keywordtype">long</span> theCrsId )</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;{</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordflow">if</span> ( !mProjListDone || !mUserProjListDone )</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  QList&lt;QTreeWidgetItem*&gt; nodes = lstCoordinateSystems-&gt;findItems( QString::number( theCrsId ), Qt::MatchExactly | Qt::MatchRecursive, QGIS_CRS_ID_COLUMN );</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordflow">if</span> ( nodes.count() == 0 )</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  lstRecent-&gt;insertTopLevelItem( 0, <span class="keyword">new</span> QTreeWidgetItem( lstRecent, QStringList()</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                                 &lt;&lt; nodes.first()-&gt;text( NAME_COLUMN )</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                                 &lt;&lt; nodes.first()-&gt;text( AUTHID_COLUMN )</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                                 &lt;&lt; nodes.first()-&gt;text( QGIS_CRS_ID_COLUMN ) ) );</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">//note this line just returns the projection name!</span></div><div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#ab728c3150f29717e163f7783806e1fb1">  277</a></span>&#160;QString <a class="code" href="classQgsProjectionSelector.html#ab728c3150f29717e163f7783806e1fb1">QgsProjectionSelector::selectedName</a>()</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;{</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  <span class="comment">// return the selected wkt name from the list view</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  QTreeWidgetItem *lvi = lstCoordinateSystems-&gt;currentItem();</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <span class="keywordflow">return</span> lvi ? lvi-&gt;text( NAME_COLUMN ) : QString::null;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;}</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">// Returns the whole proj4 string for the selected projection node</span></div><div class="line"><a name="l00285"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#af7c0a33345056d505f10573a311d2c23">  285</a></span>&#160;QString <a class="code" href="classQgsProjectionSelector.html#af7c0a33345056d505f10573a311d2c23">QgsProjectionSelector::selectedProj4String</a>()</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="comment">// Only return the projection if there is a node in the tree</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  <span class="comment">// selected that has an srid. This prevents error if the user</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;  <span class="comment">// selects a top-level node rather than an actual coordinate</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  <span class="comment">// system</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  <span class="comment">// Get the selected node</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  QTreeWidgetItem *item = lstCoordinateSystems-&gt;currentItem();</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="keywordflow">if</span> ( !item || item-&gt;text( QGIS_CRS_ID_COLUMN ).isEmpty() )</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  QString srsId = item-&gt;text( QGIS_CRS_ID_COLUMN );</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;srsId = &quot;</span> + srsId );</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;USER_CRS_START_ID = &quot;</span> + QString::number( <a class="code" href="qgis_8h.html#ad8794344628fad7031cceb6b8ab2b8ec">USER_CRS_START_ID</a> ) );</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  <span class="comment">// Determine if this is a user projection or a system on</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  <span class="comment">// user projection defs all have srs_id &gt;= 100000</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  QString databaseFileName;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <span class="keywordflow">if</span> ( srsId.toLong() &gt;= <a class="code" href="qgis_8h.html#ad8794344628fad7031cceb6b8ab2b8ec">USER_CRS_START_ID</a> )</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    databaseFileName = <a class="code" href="classQgsApplication.html#a326f95d3b446f8c3944ede386e920310">QgsApplication::qgisUserDbFilePath</a>();</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    <span class="keywordflow">if</span> ( !QFileInfo( databaseFileName ).exists() ) <span class="comment">//its unlikely that this condition will ever be reached</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <span class="keywordflow">return</span> QString( <span class="stringliteral">&quot;&quot;</span> );</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="keywordflow">else</span> <span class="comment">//must be a system projection then</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;  {</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    databaseFileName = mSrsDatabaseFileName;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  }</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;  <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;db = &quot;</span> + databaseFileName );</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;  <a class="code" href="qgscoordinatereferencesystem_8h.html#a0ef6f2646262c8a9b24368d8ac140f69">sqlite3</a> *database;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  <span class="keywordtype">int</span> rc = sqlite3_open_v2( databaseFileName.toUtf8().data(), &amp;database, SQLITE_OPEN_READONLY, NULL );</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;  <span class="keywordflow">if</span> ( rc )</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    showDBMissingWarning( databaseFileName );</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <span class="comment">// prepare the sql statement</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *tail;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  sqlite3_stmt *stmt;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;  QString sql = QString( <span class="stringliteral">&quot;select parameters from tbl_srs where srs_id=%1&quot;</span> ).arg( srsId );</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Selection sql: &quot;</span> + sql );</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  rc = sqlite3_prepare( database, sql.toUtf8(), sql.toUtf8().length(), &amp;stmt, &amp;tail );</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="comment">// XXX Need to free memory from the error msg if one is set</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  QString projString;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="keywordflow">if</span> ( rc == SQLITE_OK &amp;&amp; sqlite3_step( stmt ) == SQLITE_ROW )</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  {</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    projString = QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 0 ) );</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  }</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;  <span class="comment">// close the statement</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  sqlite3_finalize( stmt );</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="comment">// close the database</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  sqlite3_close( database );</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  Q_ASSERT( !projString.isEmpty() );</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordflow">return</span> projString;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;}</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;QString QgsProjectionSelector::getSelectedExpression( QString expression )</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;{</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="comment">// Only return the attribute if there is a node in the tree</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="comment">// selected that has an srs_id.  This prevents error if the user</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  <span class="comment">// selects a top-level node rather than an actual coordinate</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  <span class="comment">// system</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="comment">// Get the selected node and make sure it is a srs andx</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;  <span class="comment">// not a top-level projection node</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  QTreeWidgetItem *lvi = lstCoordinateSystems-&gt;currentItem();</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordflow">if</span> ( !lvi || lvi-&gt;text( QGIS_CRS_ID_COLUMN ).isEmpty() )</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="comment">// Determine if this is a user projection or a system on</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;  <span class="comment">// user projection defs all have srs_id &gt;= 100000</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  QString databaseFileName;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="keywordflow">if</span> ( lvi-&gt;text( QGIS_CRS_ID_COLUMN ).toLong() &gt;= <a class="code" href="qgis_8h.html#ad8794344628fad7031cceb6b8ab2b8ec">USER_CRS_START_ID</a> )</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  {</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    databaseFileName = <a class="code" href="classQgsApplication.html#a326f95d3b446f8c3944ede386e920310">QgsApplication::qgisUserDbFilePath</a>();</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="keywordflow">if</span> ( !QFileInfo( databaseFileName ).exists() )</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    }</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  }</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;  {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    databaseFileName = mSrsDatabaseFileName;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  }</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">// set up the database</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="comment">// XXX We could probabaly hold the database open for the life of this object,</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="comment">// assuming that it will never be used anywhere else. Given the low overhead,</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="comment">// opening it each time seems to be a reasonable approach at this time.</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <a class="code" href="qgscoordinatereferencesystem_8h.html#a0ef6f2646262c8a9b24368d8ac140f69">sqlite3</a> *database;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  <span class="keywordtype">int</span> rc = sqlite3_open_v2( databaseFileName.toUtf8().data(), &amp;database, SQLITE_OPEN_READONLY, NULL );</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  <span class="keywordflow">if</span> ( rc )</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  {</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    showDBMissingWarning( databaseFileName );</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  }</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="comment">// prepare the sql statement</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *tail;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;  sqlite3_stmt *stmt;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  QString sql = QString( <span class="stringliteral">&quot;select %1 from tbl_srs where srs_id=%2&quot;</span> )</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                .arg( expression )</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                .arg( lvi-&gt;text( QGIS_CRS_ID_COLUMN ) );</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( QString( <span class="stringliteral">&quot;Finding selected attribute using : %1&quot;</span> ).arg( sql ) );</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  rc = sqlite3_prepare( database, sql.toUtf8(), sql.toUtf8().length(), &amp;stmt, &amp;tail );</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;  <span class="comment">// XXX Need to free memory from the error msg if one is set</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;  QString attributeValue;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  <span class="keywordflow">if</span> ( rc == SQLITE_OK &amp;&amp; sqlite3_step( stmt ) == SQLITE_ROW )</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="comment">// get the first row of the result set</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    attributeValue = QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 0 ) );</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  <span class="comment">// close the statement</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  sqlite3_finalize( stmt );</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  <span class="comment">// close the database</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  sqlite3_close( database );</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  <span class="comment">// return the srs</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordflow">return</span> attributeValue;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;}</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a74584939334555688962593a7f668b8f">  424</a></span>&#160;<span class="keywordtype">long</span> <a class="code" href="classQgsProjectionSelector.html#a74584939334555688962593a7f668b8f">QgsProjectionSelector::selectedPostgresSrId</a>()</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;{</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  <span class="keywordflow">return</span> getSelectedExpression( <span class="stringliteral">&quot;srid&quot;</span> ).toLong();</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div><div class="line"><a name="l00430"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a260dba8c8ace10e2d79e159384962974">  430</a></span>&#160;QString <a class="code" href="classQgsProjectionSelector.html#a260dba8c8ace10e2d79e159384962974">QgsProjectionSelector::selectedAuthId</a>()</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;{</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="keywordtype">int</span> srid = getSelectedExpression( <span class="stringliteral">&quot;srs_id&quot;</span> ).toLong();</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="keywordflow">if</span> ( srid &gt;= <a class="code" href="qgis_8h.html#ad8794344628fad7031cceb6b8ab2b8ec">USER_CRS_START_ID</a> )</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="keywordflow">return</span> QString( <span class="stringliteral">&quot;USER:%1&quot;</span> ).arg( srid );</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">return</span> getSelectedExpression( <span class="stringliteral">&quot;upper(auth_name||&#39;:&#39;||auth_id)&quot;</span> );</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a1032346d0b096da456d4cb2ba084e8a9">  439</a></span>&#160;<span class="keywordtype">long</span> <a class="code" href="classQgsProjectionSelector.html#a1032346d0b096da456d4cb2ba084e8a9">QgsProjectionSelector::selectedCrsId</a>()</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;{</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  QTreeWidgetItem* item = lstCoordinateSystems-&gt;currentItem();</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  <span class="keywordflow">if</span> ( item &amp;&amp; !item-&gt;text( QGIS_CRS_ID_COLUMN ).isEmpty() )</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">return</span> lstCoordinateSystems-&gt;currentItem()-&gt;text( QGIS_CRS_ID_COLUMN ).toLong();</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a6665181b76bc38f653ec6650738ed60f">  450</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#a6665181b76bc38f653ec6650738ed60f">QgsProjectionSelector::setOgcWmsCrsFilter</a>( QSet&lt;QString&gt; crsFilter )</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;{</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  mCrsFilter = crsFilter;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  mProjListDone = <span class="keyword">false</span>;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  mUserProjListDone = <span class="keyword">false</span>;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;  lstCoordinateSystems-&gt;clear();</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;}</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div><div class="line"><a name="l00458"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a26f2da62808f40c7bce476ab1eac9c4b">  458</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#a26f2da62808f40c7bce476ab1eac9c4b">QgsProjectionSelector::loadUserCrsList</a>( QSet&lt;QString&gt; *crsFilter )</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;{</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  <span class="keywordflow">if</span> ( mUserProjListDone )</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Fetching user projection list...&quot;</span> );</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  <span class="comment">// convert our Coordinate Reference System filter into the SQL expression</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  QString sqlFilter = ogcWmsCrsFilterAsSqlExpression( crsFilter );</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  <span class="comment">// User defined coordinate system node</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="comment">// Make in an italic font to distinguish them from real projections</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  mUserProjList = <span class="keyword">new</span> QTreeWidgetItem( lstCoordinateSystems, QStringList( <a class="code" href="qgsrasterrenderer_8cpp.html#af8fc049fc5ce76b1f99ae93f1cf1d7eb">tr</a>( <span class="stringliteral">&quot;User Defined Coordinate Systems&quot;</span> ) ) );</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  QFont fontTemp = mUserProjList-&gt;font( 0 );</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;  fontTemp.setItalic( <span class="keyword">true</span> );</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;  fontTemp.setBold( <span class="keyword">true</span> );</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  mUserProjList-&gt;setFont( 0, fontTemp );</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  mUserProjList-&gt;setIcon( 0, QIcon( <a class="code" href="classQgsApplication.html#a29d8cdc3a25ac133c9a759a8c406435e">QgsApplication::activeThemePath</a>() + <span class="stringliteral">&quot;user.png&quot;</span> ) );</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  <span class="comment">//determine where the user proj database lives for this user. If none is found an empty</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  <span class="comment">//now only will be shown</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  QString databaseFileName = <a class="code" href="classQgsApplication.html#a326f95d3b446f8c3944ede386e920310">QgsApplication::qgisUserDbFilePath</a>();</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  <span class="comment">// first we look for ~/.qgis/qgis.db</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  <span class="comment">// if it doesnt exist we copy it in from the global resources dir</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">//return straight away if the user has not created any custom projections</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;  <span class="keywordflow">if</span> ( !QFileInfo( databaseFileName ).exists() )</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  {</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Users qgis.db not found...skipping&quot;</span> );</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    mUserProjListDone = <span class="keyword">true</span>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  }</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  <a class="code" href="qgscoordinatereferencesystem_8h.html#a0ef6f2646262c8a9b24368d8ac140f69">sqlite3</a>      *database;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>   *tail;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  sqlite3_stmt *stmt;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="comment">//check the db is available</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="keywordtype">int</span> result = sqlite3_open_v2( databaseFileName.toUtf8().constData(), &amp;database, SQLITE_OPEN_READONLY, NULL );</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">if</span> ( result )</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="comment">// XXX This will likely never happen since on open, sqlite creates the</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <span class="comment">//     database if it does not exist. But we checked earlier for its existance</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <span class="comment">//     and aborted in that case. This is because we may be runnig from read only</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">//     media such as live cd and don&#39;t want to force trying to create a db.</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    showDBMissingWarning( databaseFileName );</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="comment">// Set up the query to retrieve the projection information needed to populate the list</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  QString sql = QString( <span class="stringliteral">&quot;select description, srs_id from vw_srs where %1&quot;</span> ).arg( sqlFilter );</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  result = sqlite3_prepare( database, sql.toUtf8(), sql.toUtf8().length(), &amp;stmt, &amp;tail );</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <span class="comment">// XXX Need to free memory from the error msg if one is set</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  <span class="keywordflow">if</span> ( result == SQLITE_OK )</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  {</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    QTreeWidgetItem *newItem;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="keywordflow">while</span> ( sqlite3_step( stmt ) == SQLITE_ROW )</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      newItem = <span class="keyword">new</span> QTreeWidgetItem( mUserProjList, QStringList( QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 0 ) ) ) );</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      <span class="comment">// EpsgCrsId for user projections is not always defined in some dbases.</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      <span class="comment">// It&#39;s also not written from customprojections dialog.</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="comment">// display the epsg (field 2) in the second column of the list view</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="comment">// newItem-&gt;setText( EPSG_COLUMN, QString::fromUtf8(( char * )sqlite3_column_text( stmt, 2 ) ) );</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="comment">// display the qgis srs_id (field 1) in the third column of the list view</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      newItem-&gt;setText( QGIS_CRS_ID_COLUMN, QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 1 ) ) );</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      newItem-&gt;setText( AUTHID_COLUMN, QString( <span class="stringliteral">&quot;USER:%1&quot;</span> ).arg( QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 1 ) ).toInt() ) );</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  <span class="comment">// close the sqlite3 statement</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  sqlite3_finalize( stmt );</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  sqlite3_close( database );</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  mUserProjListDone = <span class="keyword">true</span>;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;}</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a1bb002fb20806dd66fb66bd0179a0e9a">  534</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#a1bb002fb20806dd66fb66bd0179a0e9a">QgsProjectionSelector::loadCrsList</a>( QSet&lt;QString&gt; *crsFilter )</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;{</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  <span class="keywordflow">if</span> ( mProjListDone )</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  <span class="comment">// convert our Coordinate Reference System filter into the SQL expression</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  QString sqlFilter = ogcWmsCrsFilterAsSqlExpression( crsFilter );</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <span class="comment">// Create the top-level nodes for the list view of projections</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <span class="comment">// Make in an italic font to distinguish them from real projections</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  <span class="comment">// Geographic coordinate system node</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  mGeoList = <span class="keyword">new</span> QTreeWidgetItem( lstCoordinateSystems, QStringList( <a class="code" href="qgsrasterrenderer_8cpp.html#af8fc049fc5ce76b1f99ae93f1cf1d7eb">tr</a>( <span class="stringliteral">&quot;Geographic Coordinate Systems&quot;</span> ) ) );</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;  QFont fontTemp = mGeoList-&gt;font( 0 );</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;  fontTemp.setItalic( <span class="keyword">true</span> );</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;  fontTemp.setBold( <span class="keyword">true</span> );</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;  mGeoList-&gt;setFont( 0, fontTemp );</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;  mGeoList-&gt;setIcon( 0, QIcon( <a class="code" href="classQgsApplication.html#a29d8cdc3a25ac133c9a759a8c406435e">QgsApplication::activeThemePath</a>() + <span class="stringliteral">&quot;geographic.png&quot;</span> ) );</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;  <span class="comment">// Projected coordinate system node</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;  mProjList = <span class="keyword">new</span> QTreeWidgetItem( lstCoordinateSystems, QStringList( <a class="code" href="qgsrasterrenderer_8cpp.html#af8fc049fc5ce76b1f99ae93f1cf1d7eb">tr</a>( <span class="stringliteral">&quot;Projected Coordinate Systems&quot;</span> ) ) );</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;  fontTemp = mProjList-&gt;font( 0 );</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  fontTemp.setItalic( <span class="keyword">true</span> );</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  fontTemp.setBold( <span class="keyword">true</span> );</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;  mProjList-&gt;setFont( 0, fontTemp );</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  mProjList-&gt;setIcon( 0, QIcon( <a class="code" href="classQgsApplication.html#a29d8cdc3a25ac133c9a759a8c406435e">QgsApplication::activeThemePath</a>() + <span class="stringliteral">&quot;transformed.png&quot;</span> ) );</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  <span class="comment">//bail out in case the projections db does not exist</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">//this is necessary in case the pc is running linux with a</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  <span class="comment">//read only filesystem because otherwise sqlite will try</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  <span class="comment">//to create the db file on the fly</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;  <span class="keywordflow">if</span> ( !QFileInfo( mSrsDatabaseFileName ).exists() )</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;  {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    mProjListDone = <span class="keyword">true</span>;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;  }</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;  <span class="comment">// open the database containing the spatial reference data</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <a class="code" href="qgscoordinatereferencesystem_8h.html#a0ef6f2646262c8a9b24368d8ac140f69">sqlite3</a> *database;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordtype">int</span> rc = sqlite3_open_v2( mSrsDatabaseFileName.toUtf8().data(), &amp;database, SQLITE_OPEN_READONLY, NULL );</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;  <span class="keywordflow">if</span> ( rc )</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="comment">// XXX This will likely never happen since on open, sqlite creates the</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="comment">//     database if it does not exist.</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    showDBMissingWarning( mSrsDatabaseFileName );</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span> *tail;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  sqlite3_stmt *stmt;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;  <span class="comment">// Set up the query to retrieve the projection information needed to populate the list</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  <span class="comment">//note I am giving the full field names for clarity here and in case someone</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  <span class="comment">//changes the underlying view TS</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  QString sql = QString( <span class="stringliteral">&quot;select description, srs_id, upper(auth_name||&#39;:&#39;||auth_id), is_geo, name, parameters, deprecated from vw_srs where %1 order by name,description&quot;</span> )</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                .arg( sqlFilter );</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;  rc = sqlite3_prepare( database, sql.toUtf8(), sql.toUtf8().length(), &amp;stmt, &amp;tail );</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="comment">// XXX Need to free memory from the error msg if one is set</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="keywordflow">if</span> ( rc == SQLITE_OK )</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;  {</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    QTreeWidgetItem *newItem;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="comment">// Cache some stuff to speed up creating of the list of projected</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="comment">// spatial reference systems</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    QString previousSrsType( <span class="stringliteral">&quot;&quot;</span> );</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    QTreeWidgetItem* previousSrsTypeNode = 0;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">while</span> ( sqlite3_step( stmt ) == SQLITE_ROW )</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <span class="comment">// check to see if the srs is geographic</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="keywordtype">int</span> isGeo = sqlite3_column_int( stmt, 3 );</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <span class="keywordflow">if</span> ( isGeo )</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="comment">// this is a geographic coordinate system</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="comment">// Add it to the tree (field 0)</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        newItem = <span class="keyword">new</span> QTreeWidgetItem( mGeoList, QStringList( QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 0 ) ) ) );</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="comment">// display the authority name (field 2) in the second column of the list view</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        newItem-&gt;setText( AUTHID_COLUMN, QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 2 ) ) );</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="comment">// display the qgis srs_id (field 1) in the third column of the list view</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        newItem-&gt;setText( QGIS_CRS_ID_COLUMN, QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 1 ) ) );</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      }</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      {</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="comment">// This is a projected srs</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        QTreeWidgetItem *node;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        QString srsType = QString::fromUtf8(( <span class="keywordtype">char</span>* )sqlite3_column_text( stmt, 4 ) );</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="comment">// Find the node for this type and add the projection to it</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="comment">// If the node doesn&#39;t exist, create it</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordflow">if</span> ( srsType == previousSrsType )</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;        {</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;          node = previousSrsTypeNode;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        }</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        { <span class="comment">// Different from last one, need to search</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;          QList&lt;QTreeWidgetItem*&gt; nodes = lstCoordinateSystems-&gt;findItems( srsType, Qt::MatchExactly | Qt::MatchRecursive, NAME_COLUMN );</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;          <span class="keywordflow">if</span> ( nodes.count() == 0 )</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;          {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <span class="comment">// the node doesn&#39;t exist -- create it</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            <span class="comment">// Make in an italic font to distinguish them from real projections</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            node = <span class="keyword">new</span> QTreeWidgetItem( mProjList, QStringList( srsType ) );</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            QFont fontTemp = node-&gt;font( 0 );</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            fontTemp.setItalic( <span class="keyword">true</span> );</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            node-&gt;setFont( 0, fontTemp );</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;          }</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;          {</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            node = nodes.first();</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;          }</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;          <span class="comment">// Update the cache.</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;          previousSrsType = srsType;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;          previousSrsTypeNode = node;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        <span class="comment">// add the item, setting the projection name in the first column of the list view</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        newItem = <span class="keyword">new</span> QTreeWidgetItem( node, QStringList( QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 0 ) ) ) );</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        <span class="comment">// display the authority id (field 2) in the second column of the list view</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        newItem-&gt;setText( AUTHID_COLUMN, QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 2 ) ) );</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="comment">// display the qgis srs_id (field 1) in the third column of the list view</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        newItem-&gt;setText( QGIS_CRS_ID_COLUMN, QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 1 ) ) );</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="comment">// expand also parent node</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        newItem-&gt;parent()-&gt;setExpanded( <span class="keyword">true</span> );</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="comment">// display the qgis deprecated in the user data of the item</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      newItem-&gt;setData( 0, Qt::UserRole, QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 6 ) ) );</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      newItem-&gt;setHidden( cbxHideDeprecated-&gt;isChecked() );</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    }</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    mProjList-&gt;setExpanded( <span class="keyword">true</span> );</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  }</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  <span class="comment">// close the sqlite3 statement</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  sqlite3_finalize( stmt );</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;  <span class="comment">// close the database</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  sqlite3_close( database );</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  mProjListDone = <span class="keyword">true</span>;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;}</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">// New coordinate system selected from the list</span></div><div class="line"><a name="l00676"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#afd3deeb1445f442e77d9ec6fe791a7d8">  676</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#afd3deeb1445f442e77d9ec6fe791a7d8">QgsProjectionSelector::on_lstCoordinateSystems_currentItemChanged</a>( QTreeWidgetItem *current, QTreeWidgetItem * )</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;{</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Entered.&quot;</span> );</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <span class="keywordflow">if</span> ( !current )</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  {</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;no current item&quot;</span> );</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  }</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  lstCoordinateSystems-&gt;scrollToItem( current );</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  <span class="comment">// If the item has children, it&#39;s not an end node in the tree, and</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  <span class="comment">// hence is just a grouping thingy, not an actual CRS.</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  <span class="keywordflow">if</span> ( current-&gt;childCount() == 0 )</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <span class="comment">// Found a real CRS</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    emit <a class="code" href="classQgsProjectionSelector.html#a41f31a17186d424c1202d67f064215a4">sridSelected</a>( QString::number( <a class="code" href="classQgsProjectionSelector.html#a1032346d0b096da456d4cb2ba084e8a9">selectedCrsId</a>() ) );</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    teProjection-&gt;setText( <a class="code" href="classQgsProjectionSelector.html#af7c0a33345056d505f10573a311d2c23">selectedProj4String</a>() );</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    teSelected-&gt;setText( <a class="code" href="classQgsProjectionSelector.html#ab728c3150f29717e163f7783806e1fb1">selectedName</a>() );</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    QList&lt;QTreeWidgetItem*&gt; nodes = lstRecent-&gt;findItems( current-&gt;text( QGIS_CRS_ID_COLUMN ), Qt::MatchExactly, QGIS_CRS_ID_COLUMN );</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <span class="keywordflow">if</span> ( nodes.count() &gt; 0 )</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    {</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( QString( <span class="stringliteral">&quot;found srs %1 in recent&quot;</span> ).arg( current-&gt;text( QGIS_CRS_ID_COLUMN ) ) );</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      lstRecent-&gt;setCurrentItem( nodes.first() );</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    }</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( QString( <span class="stringliteral">&quot;srs %1 not recent&quot;</span> ).arg( current-&gt;text( QGIS_CRS_ID_COLUMN ) ) );</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      lstRecent-&gt;clearSelection();</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      lstCoordinateSystems-&gt;setFocus( Qt::OtherFocusReason );</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    }</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  }</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">// Not an CRS - remove the highlight so the user doesn&#39;t get too confused</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    current-&gt;setSelected( <span class="keyword">false</span> );</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    teProjection-&gt;setText( <span class="stringliteral">&quot;&quot;</span> );</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    teSelected-&gt;setText( <span class="stringliteral">&quot;&quot;</span> );</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    lstRecent-&gt;clearSelection();</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;  }</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;}</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a8c5725a743a6cd7b4c26c5c10a9de000">  721</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#a8c5725a743a6cd7b4c26c5c10a9de000">QgsProjectionSelector::on_lstRecent_currentItemChanged</a>( QTreeWidgetItem *current, QTreeWidgetItem * )</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;{</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;Entered.&quot;</span> );</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;  <span class="keywordflow">if</span> ( !current )</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;  {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( <span class="stringliteral">&quot;no current item&quot;</span> );</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordflow">return</span>;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  }</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  lstRecent-&gt;scrollToItem( current );</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  QList&lt;QTreeWidgetItem*&gt; nodes = lstCoordinateSystems-&gt;findItems( current-&gt;text( QGIS_CRS_ID_COLUMN ), Qt::MatchExactly | Qt::MatchRecursive, QGIS_CRS_ID_COLUMN );</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keywordflow">if</span> ( nodes.count() &gt; 0 )</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    lstCoordinateSystems-&gt;setCurrentItem( nodes.first() );</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;}</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="keywordtype">void</span> QgsProjectionSelector::hideDeprecated( QTreeWidgetItem *item )</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;{</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="keywordflow">if</span> ( item-&gt;data( 0, Qt::UserRole ).toBool() )</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    item-&gt;setHidden( cbxHideDeprecated-&gt;isChecked() );</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="keywordflow">if</span> ( item-&gt;isSelected() &amp;&amp; item-&gt;isHidden() )</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    {</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      item-&gt;setSelected( <span class="keyword">false</span> );</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      teProjection-&gt;setText( <span class="stringliteral">&quot;&quot;</span> );</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      teSelected-&gt;setText( <span class="stringliteral">&quot;&quot;</span> );</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    }</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; item-&gt;childCount(); i++ )</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    hideDeprecated( item-&gt;child( i ) );</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;}</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div><div class="line"><a name="l00755"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a7dc52e836d87487973760561ce41756e">  755</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#a7dc52e836d87487973760561ce41756e">QgsProjectionSelector::on_cbxHideDeprecated_stateChanged</a>()</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;{</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; lstCoordinateSystems-&gt;topLevelItemCount(); i++ )</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    hideDeprecated( lstCoordinateSystems-&gt;topLevelItem( i ) );</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;}</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a53e42448f064491d4d92afa651330a7b">  761</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#a53e42448f064491d4d92afa651330a7b">QgsProjectionSelector::on_leSearch_textChanged</a>( <span class="keyword">const</span> QString &amp; theFilterTxt )</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;{</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  QString filterTxt = theFilterTxt;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;  filterTxt.replace( QRegExp( <span class="stringliteral">&quot;\\s+&quot;</span> ), <span class="stringliteral">&quot;.*&quot;</span> );</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  QRegExp re( filterTxt, Qt::CaseInsensitive );</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="comment">// filter recent crs&#39;s</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  QTreeWidgetItemIterator itr( lstRecent );</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="keywordflow">while</span> ( *itr )</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  {</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    <span class="keywordflow">if</span> (( *itr )-&gt;childCount() == 0 ) <span class="comment">// it&#39;s an end node aka a projection</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <span class="keywordflow">if</span> (( *itr )-&gt;text( NAME_COLUMN ).contains( re )</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;          || ( *itr )-&gt;text( AUTHID_COLUMN ).contains( re )</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;         )</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      {</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        ( *itr )-&gt;setHidden( <span class="keyword">false</span> );</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        QTreeWidgetItem * parent = ( *itr )-&gt;parent();</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">while</span> ( parent )</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;          parent-&gt;setExpanded( <span class="keyword">true</span> );</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;          parent-&gt;setHidden( <span class="keyword">false</span> );</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;          parent = parent-&gt;parent();</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      }</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      {</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        ( *itr )-&gt;setHidden( <span class="keyword">true</span> );</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      }</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    }</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    {</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      ( *itr )-&gt;setHidden( <span class="keyword">true</span> );</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    ++itr;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  }</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="comment">// filter crs&#39;s</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  QTreeWidgetItemIterator it( lstCoordinateSystems );</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keywordflow">while</span> ( *it )</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  {</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">if</span> (( *it )-&gt;childCount() == 0 ) <span class="comment">// it&#39;s an end node aka a projection</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;    {</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <span class="keywordflow">if</span> (( *it )-&gt;text( NAME_COLUMN ).contains( re )</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;          || ( *it )-&gt;text( AUTHID_COLUMN ).contains( re )</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;         )</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;      {</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        ( *it )-&gt;setHidden( <span class="keyword">false</span> );</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        QTreeWidgetItem * parent = ( *it )-&gt;parent();</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        <span class="keywordflow">while</span> ( parent )</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;          parent-&gt;setExpanded( <span class="keyword">true</span> );</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;          parent-&gt;setHidden( <span class="keyword">false</span> );</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;          parent = parent-&gt;parent();</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        }</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        ( *it )-&gt;setHidden( <span class="keyword">true</span> );</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    }</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    {</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      ( *it )-&gt;setHidden( <span class="keyword">true</span> );</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    }</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    ++it;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;}</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a371a1135cb3f5ca64ffece48a48c1f31">  831</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classQgsProjectionSelector.html#a371a1135cb3f5ca64ffece48a48c1f31">QgsProjectionSelector::pushProjectionToFront</a>()</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;{</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="comment">// set flag to push selected projection to front in destructor</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  mPushProjectionToFront = <span class="keyword">true</span>;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;}</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="keywordtype">long</span> QgsProjectionSelector::getLargestCRSIDMatch( QString theSql )</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;{</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="keywordtype">long</span> srsId = 0;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="comment">// Now perform the actual search</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <a class="code" href="qgscoordinatereferencesystem_8h.html#a0ef6f2646262c8a9b24368d8ac140f69">sqlite3</a>      *database;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>   *tail;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  sqlite3_stmt *stmt;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keywordtype">int</span>           result;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="comment">// first we search the users db as any srsid there will be definition be greater than in sys db</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="comment">//check the db is available</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  QString databaseFileName = <a class="code" href="classQgsApplication.html#a326f95d3b446f8c3944ede386e920310">QgsApplication::qgisUserDbFilePath</a>();</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="keywordflow">if</span> ( QFileInfo( databaseFileName ).exists() ) <span class="comment">//only bother trying to open if the file exists</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  {</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    result = sqlite3_open_v2( databaseFileName.toUtf8().data(), &amp;database, SQLITE_OPEN_READONLY, NULL );</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">if</span> ( result )</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="comment">// XXX This will likely never happen since on open, sqlite creates the</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      <span class="comment">//     database if it does not exist. But we checked earlier for its existance</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      <span class="comment">//     and aborted in that case. This is because we may be runnig from read only</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <span class="comment">//     media such as live cd and don&#39;t want to force trying to create a db.</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      showDBMissingWarning( databaseFileName );</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    }</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    result = sqlite3_prepare( database, theSql.toUtf8(), theSql.toUtf8().length(), &amp;stmt, &amp;tail );</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="comment">// XXX Need to free memory from the error msg if one is set</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    <span class="keywordflow">if</span> ( result == SQLITE_OK &amp;&amp; sqlite3_step( stmt ) == SQLITE_ROW )</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    {</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      QString srsIdString = QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 0 ) );</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      srsId = srsIdString.toLong();</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="comment">// close the sqlite3 statement</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      sqlite3_finalize( stmt );</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      sqlite3_close( database );</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <span class="keywordflow">return</span> srsId;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    }</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  }</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  {</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    <span class="comment">//only bother looking in srs.db if it wasnt found above</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    result = sqlite3_open_v2( mSrsDatabaseFileName.toUtf8().data(), &amp;database, SQLITE_OPEN_READONLY, NULL );</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">if</span> ( result )</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( QString( <span class="stringliteral">&quot;Can&#39;t open * user * database: %1&quot;</span> ).arg( sqlite3_errmsg( database ) ) );</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <span class="comment">//no need for assert because user db may not have been created yet</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  }</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  result = sqlite3_prepare( database, theSql.toUtf8(), theSql.toUtf8().length(), &amp;stmt, &amp;tail );</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  <span class="comment">// XXX Need to free memory from the error msg if one is set</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="keywordflow">if</span> ( result == SQLITE_OK &amp;&amp; sqlite3_step( stmt ) == SQLITE_ROW )</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  {</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    QString srsIdString = QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 0 ) );</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    srsId = srsIdString.toLong();</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;  }</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="comment">// close the sqlite3 statement</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;  sqlite3_finalize( stmt );</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  sqlite3_close( database );</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="keywordflow">return</span> srsId;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;}</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;QStringList QgsProjectionSelector::authorities()</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;{</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  <a class="code" href="qgscoordinatereferencesystem_8h.html#a0ef6f2646262c8a9b24368d8ac140f69">sqlite3</a>      *database;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>   *tail;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  sqlite3_stmt *stmt;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  <span class="keywordtype">int</span> result = sqlite3_open_v2( mSrsDatabaseFileName.toUtf8().data(), &amp;database, SQLITE_OPEN_READONLY, NULL );</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  <span class="keywordflow">if</span> ( result )</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  {</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <a class="code" href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a>( QString( <span class="stringliteral">&quot;Can&#39;t open * user * database: %1&quot;</span> ).arg( sqlite3_errmsg( database ) ) );</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="comment">//no need for assert because user db may not have been created yet</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="keywordflow">return</span> QStringList();</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  }</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  QString theSql = <span class="stringliteral">&quot;select distinct auth_name from tbl_srs&quot;</span>;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  result = sqlite3_prepare( database, theSql.toUtf8(), theSql.toUtf8().length(), &amp;stmt, &amp;tail );</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  QStringList authorities;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="keywordflow">if</span> ( result == SQLITE_OK )</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">while</span> ( sqlite3_step( stmt ) == SQLITE_ROW )</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    {</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      authorities &lt;&lt; QString::fromUtf8(( <span class="keywordtype">char</span> * )sqlite3_column_text( stmt, 0 ) );</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="comment">// close the sqlite3 statement</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  sqlite3_finalize( stmt );</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  sqlite3_close( database );</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  <span class="keywordflow">return</span> authorities;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;}</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno"><a class="line" href="classQgsProjectionSelector.html#a7f9531610bd8aa59ea032cd65eb5f8be">  950</a></span>&#160;<span class="keyword">const</span> QString <a class="code" href="classQgsProjectionSelector.html#a7f9531610bd8aa59ea032cd65eb5f8be">QgsProjectionSelector::sqlSafeString</a>( <span class="keyword">const</span> QString theSQL )</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;{</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  QString retval = theSQL;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  retval.replace( <span class="stringliteral">&quot;\\&quot;</span>, <span class="stringliteral">&quot;\\\\&quot;</span> );</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  retval.replace( <span class="charliteral">&#39;\&quot;&#39;</span>, <span class="stringliteral">&quot;\\\&quot;&quot;</span> );</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  retval.replace( <span class="stringliteral">&quot;\&#39;&quot;</span>, <span class="stringliteral">&quot;\\&#39;&quot;</span> );</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  retval.replace( <span class="stringliteral">&quot;%&quot;</span>, <span class="stringliteral">&quot;\\%&quot;</span> );</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  <span class="keywordflow">return</span> retval;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;}</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="keywordtype">void</span> QgsProjectionSelector::showDBMissingWarning( <span class="keyword">const</span> QString theFileName )</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;{</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  QMessageBox::critical( <span class="keyword">this</span>, <a class="code" href="qgsrasterrenderer_8cpp.html#af8fc049fc5ce76b1f99ae93f1cf1d7eb">tr</a>( <span class="stringliteral">&quot;Resource Location Error&quot;</span> ),</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                         <a class="code" href="qgsrasterrenderer_8cpp.html#af8fc049fc5ce76b1f99ae93f1cf1d7eb">tr</a>( <span class="stringliteral">&quot;Error reading database file from: \n %1\n&quot;</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                             <span class="stringliteral">&quot;Because of this the projection selector will not work...&quot;</span> )</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                         .arg( theFileName ) );</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;}</div><div class="ttc" id="classQgsProjectionSelector_html_a7f9531610bd8aa59ea032cd65eb5f8be"><div class="ttname"><a href="classQgsProjectionSelector.html#a7f9531610bd8aa59ea032cd65eb5f8be">QgsProjectionSelector::sqlSafeString</a></div><div class="ttdeci">const QString sqlSafeString(const QString theSQL)</div><div class="ttdoc">Make the string safe for use in SQL statements. This involves escaping single quotes, double quotes, backslashes, and optionally, percentage symbols. Percentage symbols are used as wildcards sometimes and so when using the string as part of the LIKE phrase of a select statement, should be escaped. </div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00950">qgsprojectionselector.cpp:950</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a6f161369439d52b649c8f4f0a1d04e5d"><div class="ttname"><a href="classQgsProjectionSelector.html#a6f161369439d52b649c8f4f0a1d04e5d">QgsProjectionSelector::resizeEvent</a></div><div class="ttdeci">void resizeEvent(QResizeEvent *theEvent) override</div><div class="ttdoc">Used to manage column sizes. </div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00114">qgsprojectionselector.cpp:114</a></div></div>
<div class="ttc" id="classQgsApplication_html_a29d8cdc3a25ac133c9a759a8c406435e"><div class="ttname"><a href="classQgsApplication.html#a29d8cdc3a25ac133c9a759a8c406435e">QgsApplication::activeThemePath</a></div><div class="ttdeci">static const QString activeThemePath()</div><div class="ttdoc">Returns the path to the currently active theme directory. </div><div class="ttdef"><b>Definition:</b> <a href="qgsapplication_8cpp_source.html#l00370">qgsapplication.cpp:370</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a6665181b76bc38f653ec6650738ed60f"><div class="ttname"><a href="classQgsProjectionSelector.html#a6665181b76bc38f653ec6650738ed60f">QgsProjectionSelector::setOgcWmsCrsFilter</a></div><div class="ttdeci">void setOgcWmsCrsFilter(QSet&lt; QString &gt; crsFilter)</div><div class="ttdoc">filters this widget by the given CRSs </div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00450">qgsprojectionselector.cpp:450</a></div></div>
<div class="ttc" id="qgslogger_8h_html_ab273942cfb1b76ef0a5dafe6ed64fe23"><div class="ttname"><a href="qgslogger_8h.html#ab273942cfb1b76ef0a5dafe6ed64fe23">QgsDebugMsg</a></div><div class="ttdeci">#define QgsDebugMsg(str)</div><div class="ttdef"><b>Definition:</b> <a href="qgslogger_8h_source.html#l00033">qgslogger.h:33</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a40d5cbda59e1a36fd5ae761c42b24576"><div class="ttname"><a href="classQgsProjectionSelector.html#a40d5cbda59e1a36fd5ae761c42b24576">QgsProjectionSelector::QgsProjectionSelector</a></div><div class="ttdeci">QgsProjectionSelector(QWidget *parent, const char *name=&quot;&quot;, Qt::WindowFlags fl=0)</div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00029">qgsprojectionselector.cpp:29</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_aeb54a075f8275a8e6c652d899f65db51"><div class="ttname"><a href="classQgsProjectionSelector.html#aeb54a075f8275a8e6c652d899f65db51">QgsProjectionSelector::setSelectedCrsId</a></div><div class="ttdeci">void setSelectedCrsId(long theCRSID)</div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00211">qgsprojectionselector.cpp:211</a></div></div>
<div class="ttc" id="classQgsCoordinateReferenceSystem_html_a433853323df4837869a2a8c2ad7521ea"><div class="ttname"><a href="classQgsCoordinateReferenceSystem.html#a433853323df4837869a2a8c2ad7521ea">QgsCoordinateReferenceSystem::toProj4</a></div><div class="ttdeci">QString toProj4() const</div><div class="ttdoc">Get the Proj Proj4 string representation of this srs. </div><div class="ttdef"><b>Definition:</b> <a href="qgscoordinatereferencesystem_8cpp_source.html#l00875">qgscoordinatereferencesystem.cpp:875</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_af7c0a33345056d505f10573a311d2c23"><div class="ttname"><a href="classQgsProjectionSelector.html#af7c0a33345056d505f10573a311d2c23">QgsProjectionSelector::selectedProj4String</a></div><div class="ttdeci">QString selectedProj4String()</div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00285">qgsprojectionselector.cpp:285</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_ab728c3150f29717e163f7783806e1fb1"><div class="ttname"><a href="classQgsProjectionSelector.html#ab728c3150f29717e163f7783806e1fb1">QgsProjectionSelector::selectedName</a></div><div class="ttdeci">QString selectedName()</div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00277">qgsprojectionselector.cpp:277</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a74584939334555688962593a7f668b8f"><div class="ttname"><a href="classQgsProjectionSelector.html#a74584939334555688962593a7f668b8f">QgsProjectionSelector::selectedPostgresSrId</a></div><div class="ttdeci">long selectedPostgresSrId()</div><div class="ttdoc">Gets the current PostGIS-style projection identifier. </div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00424">qgsprojectionselector.cpp:424</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a26f2da62808f40c7bce476ab1eac9c4b"><div class="ttname"><a href="classQgsProjectionSelector.html#a26f2da62808f40c7bce476ab1eac9c4b">QgsProjectionSelector::loadUserCrsList</a></div><div class="ttdeci">void loadUserCrsList(QSet&lt; QString &gt; *crsFilter=0)</div><div class="ttdoc">Populate the proj tree view with user defined projection names... </div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00458">qgsprojectionselector.cpp:458</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a8b94413941d2887c38ddb7f9498e77c9"><div class="ttname"><a href="classQgsProjectionSelector.html#a8b94413941d2887c38ddb7f9498e77c9">QgsProjectionSelector::setSelectedCrsName</a></div><div class="ttdeci">void setSelectedCrsName(QString theCRSName)</div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00206">qgsprojectionselector.cpp:206</a></div></div>
<div class="ttc" id="classQgsCoordinateReferenceSystem_html_a50be71ef85725c7a3959f780ac7c36cfabc92b4ee3c6be188b5dfe000ddac415e"><div class="ttname"><a href="classQgsCoordinateReferenceSystem.html#a50be71ef85725c7a3959f780ac7c36cfabc92b4ee3c6be188b5dfe000ddac415e">QgsCoordinateReferenceSystem::InternalCrsId</a></div><div class="ttdef"><b>Definition:</b> <a href="qgscoordinatereferencesystem_8h_source.html#l00056">qgscoordinatereferencesystem.h:56</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a8c5725a743a6cd7b4c26c5c10a9de000"><div class="ttname"><a href="classQgsProjectionSelector.html#a8c5725a743a6cd7b4c26c5c10a9de000">QgsProjectionSelector::on_lstRecent_currentItemChanged</a></div><div class="ttdeci">void on_lstRecent_currentItemChanged(QTreeWidgetItem *current, QTreeWidgetItem *prev)</div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00721">qgsprojectionselector.cpp:721</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a260dba8c8ace10e2d79e159384962974"><div class="ttname"><a href="classQgsProjectionSelector.html#a260dba8c8ace10e2d79e159384962974">QgsProjectionSelector::selectedAuthId</a></div><div class="ttdeci">QString selectedAuthId()</div><div class="ttdoc">Gets the current authority-style projection identifier. </div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00430">qgsprojectionselector.cpp:430</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_ae7cb639b4728c35a44c190ac89c6f7f2"><div class="ttname"><a href="classQgsProjectionSelector.html#ae7cb639b4728c35a44c190ac89c6f7f2">QgsProjectionSelector::~QgsProjectionSelector</a></div><div class="ttdeci">~QgsProjectionSelector()</div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00069">qgsprojectionselector.cpp:69</a></div></div>
<div class="ttc" id="classQgsCoordinateReferenceSystem_html_a22bb0b4fee4e7e251f52433df846e202"><div class="ttname"><a href="classQgsCoordinateReferenceSystem.html#a22bb0b4fee4e7e251f52433df846e202">QgsCoordinateReferenceSystem::recentProjections</a></div><div class="ttdeci">static QStringList recentProjections()</div><div class="ttdoc">Returns a list of recently used projections. </div><div class="ttdef"><b>Definition:</b> <a href="qgscoordinatereferencesystem_8cpp_source.html#l01587">qgscoordinatereferencesystem.cpp:1587</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_ae9743d9161df77ed762178c4ec7b38d4"><div class="ttname"><a href="classQgsProjectionSelector.html#ae9743d9161df77ed762178c4ec7b38d4">QgsProjectionSelector::setSelectedAuthId</a></div><div class="ttdeci">void setSelectedAuthId(QString authId)</div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00216">qgsprojectionselector.cpp:216</a></div></div>
<div class="ttc" id="qgsapplication_8h_html"><div class="ttname"><a href="qgsapplication_8h.html">qgsapplication.h</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a7dc52e836d87487973760561ce41756e"><div class="ttname"><a href="classQgsProjectionSelector.html#a7dc52e836d87487973760561ce41756e">QgsProjectionSelector::on_cbxHideDeprecated_stateChanged</a></div><div class="ttdeci">void on_cbxHideDeprecated_stateChanged()</div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00755">qgsprojectionselector.cpp:755</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_afd3deeb1445f442e77d9ec6fe791a7d8"><div class="ttname"><a href="classQgsProjectionSelector.html#afd3deeb1445f442e77d9ec6fe791a7d8">QgsProjectionSelector::on_lstCoordinateSystems_currentItemChanged</a></div><div class="ttdeci">void on_lstCoordinateSystems_currentItemChanged(QTreeWidgetItem *current, QTreeWidgetItem *prev)</div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00676">qgsprojectionselector.cpp:676</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a41f31a17186d424c1202d67f064215a4"><div class="ttname"><a href="classQgsProjectionSelector.html#a41f31a17186d424c1202d67f064215a4">QgsProjectionSelector::sridSelected</a></div><div class="ttdeci">void sridSelected(QString theSRID)</div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a53e42448f064491d4d92afa651330a7b"><div class="ttname"><a href="classQgsProjectionSelector.html#a53e42448f064491d4d92afa651330a7b">QgsProjectionSelector::on_leSearch_textChanged</a></div><div class="ttdeci">void on_leSearch_textChanged(const QString &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00761">qgsprojectionselector.cpp:761</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a371a1135cb3f5ca64ffece48a48c1f31"><div class="ttname"><a href="classQgsProjectionSelector.html#a371a1135cb3f5ca64ffece48a48c1f31">QgsProjectionSelector::pushProjectionToFront</a></div><div class="ttdeci">void pushProjectionToFront()</div><div class="ttdoc">mark selected projection for push to front </div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00831">qgsprojectionselector.cpp:831</a></div></div>
<div class="ttc" id="qgscoordinatereferencesystem_8h_html_a0ef6f2646262c8a9b24368d8ac140f69"><div class="ttname"><a href="qgscoordinatereferencesystem_8h.html#a0ef6f2646262c8a9b24368d8ac140f69">sqlite3</a></div><div class="ttdeci">struct sqlite3 sqlite3</div><div class="ttdef"><b>Definition:</b> <a href="qgscoordinatereferencesystem_8h_source.html#l00033">qgscoordinatereferencesystem.h:33</a></div></div>
<div class="ttc" id="qgis_8h_html_ad8794344628fad7031cceb6b8ab2b8ec"><div class="ttname"><a href="qgis_8h.html#ad8794344628fad7031cceb6b8ab2b8ec">USER_CRS_START_ID</a></div><div class="ttdeci">const int USER_CRS_START_ID</div><div class="ttdoc">Magick number that determines whether a projection crsid is a system (srs.db) or user (~/...</div><div class="ttdef"><b>Definition:</b> <a href="qgis_8h_source.html#l00393">qgis.h:393</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a1bb002fb20806dd66fb66bd0179a0e9a"><div class="ttname"><a href="classQgsProjectionSelector.html#a1bb002fb20806dd66fb66bd0179a0e9a">QgsProjectionSelector::loadCrsList</a></div><div class="ttdeci">void loadCrsList(QSet&lt; QString &gt; *crsFilter=0)</div><div class="ttdoc">Populate the proj tree view with system projection names... </div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00534">qgsprojectionselector.cpp:534</a></div></div>
<div class="ttc" id="qgsprojectionselector_8h_html"><div class="ttname"><a href="qgsprojectionselector_8h.html">qgsprojectionselector.h</a></div></div>
<div class="ttc" id="classQgsCoordinateReferenceSystem_html"><div class="ttname"><a href="classQgsCoordinateReferenceSystem.html">QgsCoordinateReferenceSystem</a></div><div class="ttdoc">Class for storing a coordinate reference system (CRS) </div><div class="ttdef"><b>Definition:</b> <a href="qgscoordinatereferencesystem_8h_source.html#l00050">qgscoordinatereferencesystem.h:50</a></div></div>
<div class="ttc" id="classQgsApplication_html_ade49108acdad95ab09c8098a528659f8"><div class="ttname"><a href="classQgsApplication.html#ade49108acdad95ab09c8098a528659f8">QgsApplication::srsDbFilePath</a></div><div class="ttdeci">static const QString srsDbFilePath()</div><div class="ttdoc">Returns the path to the srs.db file. </div><div class="ttdef"><b>Definition:</b> <a href="qgsapplication_8cpp_source.html#l00589">qgsapplication.cpp:589</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a1ee56be1f78b0ea3b43a489c85592ab6"><div class="ttname"><a href="classQgsProjectionSelector.html#a1ee56be1f78b0ea3b43a489c85592ab6">QgsProjectionSelector::initialized</a></div><div class="ttdeci">void initialized()</div><div class="ttdoc">Notify others that the widget is now fully initialized, including deferred selection of projection...</div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a9c9e1adc0e4f1e4c909fe77675c565c1"><div class="ttname"><a href="classQgsProjectionSelector.html#a9c9e1adc0e4f1e4c909fe77675c565c1">QgsProjectionSelector::showEvent</a></div><div class="ttdeci">void showEvent(QShowEvent *theEvent) override</div><div class="ttdoc">Used to ensure the projection list view is actually populated. </div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00125">qgsprojectionselector.cpp:125</a></div></div>
<div class="ttc" id="qgis_8h_html"><div class="ttname"><a href="qgis_8h.html">qgis.h</a></div></div>
<div class="ttc" id="classQgsApplication_html_a326f95d3b446f8c3944ede386e920310"><div class="ttname"><a href="classQgsApplication.html#a326f95d3b446f8c3944ede386e920310">QgsApplication::qgisUserDbFilePath</a></div><div class="ttdeci">static const QString qgisUserDbFilePath()</div><div class="ttdoc">Returns the path to the user qgis.db file. </div><div class="ttdef"><b>Definition:</b> <a href="qgsapplication_8cpp_source.html#l00566">qgsapplication.cpp:566</a></div></div>
<div class="ttc" id="qgscoordinatereferencesystem_8h_html"><div class="ttname"><a href="qgscoordinatereferencesystem_8h.html">qgscoordinatereferencesystem.h</a></div></div>
<div class="ttc" id="qgslogger_8h_html"><div class="ttname"><a href="qgslogger_8h.html">qgslogger.h</a></div></div>
<div class="ttc" id="qgsrasterrenderer_8cpp_html_af8fc049fc5ce76b1f99ae93f1cf1d7eb"><div class="ttname"><a href="qgsrasterrenderer_8cpp.html#af8fc049fc5ce76b1f99ae93f1cf1d7eb">tr</a></div><div class="ttdeci">#define tr(sourceText)</div><div class="ttdef"><b>Definition:</b> <a href="qgsrasterrenderer_8cpp_source.html#l00027">qgsrasterrenderer.cpp:27</a></div></div>
<div class="ttc" id="classQgsProjectionSelector_html_a1032346d0b096da456d4cb2ba084e8a9"><div class="ttname"><a href="classQgsProjectionSelector.html#a1032346d0b096da456d4cb2ba084e8a9">QgsProjectionSelector::selectedCrsId</a></div><div class="ttdeci">long selectedCrsId()</div><div class="ttdoc">Gets the current QGIS projection identfier. </div><div class="ttdef"><b>Definition:</b> <a href="qgsprojectionselector_8cpp_source.html#l00439">qgsprojectionselector.cpp:439</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jul 16 2018 16:06:30 for QGIS API Documentation by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
